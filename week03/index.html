<!doctype html><html lang=en><head><meta charset=utf-8><title>Week03: ??</title><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black-translucent"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><link rel=stylesheet href=../reveal-js/css/reset.css><link rel=stylesheet href=../reveal-js/css/reveal.css><link rel=stylesheet href=../reveal-js/css/theme/black.css id=theme><link rel=stylesheet href=../highlight-js/default.min.css></head><body><div class=reveal><div class=slides><section><h2 id=well-get-started-at-1305>We&rsquo;ll get started at 13:05</h2></section><section data-noprocess data-shortcode-slide class=center><h1 id=week03>Week03</h1><h2 id=todo>TODO</h2></section><section><h2 id=disclaimer>disclaimer</h2><ul><li>many of the tools and techniques discussed in these sessions could be used against real websites/applications</li><li>this is quite</li></ul></section><section><h2 id=acknowledgement-of-country>acknowledgement of country</h2><ul><li>We begin by acknowledging the Traditional Custodians of the land on which we meet, and pay our respects to their Elders past and present. We extend that arespect to Aboriginal and Torres Strait Islander peoples here today.</li></ul></section><section><section data-shortcode-section><h2 id=what-will-we-cover-this-session>what will we cover this session</h2><ul><li>SQLi</li><li>SSTI</li><li>SSRF</li><li>File uploads</li></ul></section></section><section><h2 id=sql>SQL</h2><section data-shortcode-section><blockquote><p>Structured Query Language</p></blockquote><ul><li>SQLite, PostgreSQL, MySQL, MSSQL Server</li></ul></section><section><blockquote><p>Fingerprinting</p></blockquote><ul><li>work out the flavour/version<ul><li><strong>MySQL</strong>: <code>Version()</code></li><li><strong>SQLite</strong>: <code>sqlite_version()</code></li><li><strong>MSSQL</strong>: <code>@@Version</code></li></ul></li></ul></section><section><blockquote><p>Finding the schema</p></blockquote><ul><li>what tables exist, what do they look like?<ul><li><strong>MySQL</strong>: <code>information_schema.[tables|columns]</code></li><li><strong>SQLite</strong>: <code>sqlite_[master|schema]</code></li><li><strong>MSSQL</strong>: <code>SHOW TABLES; DESCRIBE &lt;table_name></code></li></ul></li></ul></section><section><p>Queries ></p><ul><li><code>SELECT &lt;column> FROM &lt;table>;</code></li><li><code>INSERT INTO table VALUES (a, b);</code></li><li><code>UPDATE table SET ... = ...</code></li><li><del><code>DELETE FROM table ...</code></del> (<em>pls dont</em>)</li><li><code>-- a comment (also #)</code></li></ul></section><section><p><code>SELECT \* FROM table WHERE ...</code></p><ul><li><code>col = ...</code></li><li><code>col > ...</code></li><li><code>col &lt; ...</code></li><li><code>col &lt;> ... #</code> not equals (!=)</li><li><code>col LIKE ... #</code> regexp<ul><li><code>_</code> <code>(.)</code> and <code>%</code> <code>(.*)</code> are wildcards</li></ul></li></ul></section><section><p><code>SELECT user, pass FROM users UNION SELECT title, author FROM blogs</code></p><pre tabindex=0><code>  user	  pass	     id	  title   author	THE UNION
|=======|=======|   |===|=======|=======|   |=======|=======|
| admin	| admin	|   | 1 | blog1 | melon |   | admin | admin |
| melon	| water	|   | 2 | blog2 | admin |   | melon | water |
|=======|=======|   | 3 | blog3 | admin |   | blog1 | melon |
		    |===|=======|=======|   | blog2 | admin |
		 		    	    | blog3 | admin |
      users		   blogs	    |=======|=======|
</code></pre></section><section><h2 id=notes-on-unions>Notes on UNIONs</h2><ul><li>The query needs to extract the same number of columns from both tables</li><li>The data-type for the columns must be compatible</li><li>You can also UNION the same table</li></ul></section></section><section><h2 id=sqli>SQLi</h2><section data-shortcode-section><h3 id=sql-injection>SQL Injection</h3><ul><li><p><em>TLDR</em>: blindly trusting user input is bad</p></li><li><p>What if we injected control characters which changed how the database interprets the query? e.g. inject our own <code>UNIONs/WHEREs/etc</code></p></li><li><p>How could it tell the difference?</p></li></ul></section><section><h3 id=how-does-sqli-work>How does SQLi work</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> users <span style=color:#66d9ef>WHERE</span> <span style=color:#66d9ef>user</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;{input}&#39;</span> <span style=color:#66d9ef>AND</span> password <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;{...}&#39;</span>
</span></span></code></pre></div><p> </p><p>If our input was: <code>' OR 1=1 --</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#75715e>--                        vvvvvvvvvvvvvvvvvvvv
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> users <span style=color:#66d9ef>WHERE</span> <span style=color:#66d9ef>user</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span> <span style=color:#66d9ef>OR</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> <span style=color:#75715e>--&#39;and password = &#39;...&#39;
</span></span></span><span style=display:flex><span><span style=color:#75715e>--                        ^^^^^^^^^^^^^^^^^^^^
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- user = &#39;&#39; is always false, but 1=1 is always true
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- so this will return every user from the database
</span></span></span></code></pre></div></section><section><h3 id=issues-you-may-encounter>Issues you may encounter</h3><ul><li><p>Syntax needs to be correct, or you&rsquo;ll throw an error</p><ul><li>so, determine syntax through errors/fingerprint</li></ul></li><li><p>You have SQLi in <code>items</code>, but want <code>users</code></p><ul><li>find out the tables? (database schema)</li><li>include that table with a <code>UNION</code></li></ul></li></ul></section><section><h1 id=sqli-demo>SQLi Demo</h1><blockquote><p>A basic login form</p></blockquote></section></section><section><section data-shortcode-section><h2 id=ssti>SSTI</h2><h3 id=server-side-template-injection>Server-side template injection</h3><p>Templating engines (eg. Jinja2, Pug) use templates to inject code and variables into static files</p></section><section><h3 id=what-is-templating>what is templating</h3><p>similar to using variables in print</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>print(<span style=color:#e6db74>&#39;Hello &#39;</span> <span style=color:#f92672>+</span> name)
</span></span></code></pre></div><p> </p><p>except you&rsquo;re using it for writing web content</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#75715e>&lt;!-- index.html --&gt;</span>
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>h1</span>&gt;Hello {{name}}&lt;/<span style=color:#f92672>h1</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>div</span>&gt;it is currently {{time}}&lt;/<span style=color:#f92672>div</span>&gt;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#75715e># main.py</span>
</span></span><span style=display:flex><span>render_template(<span style=color:#e6db74>&#34;index.html&#34;</span>, name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;melon&#34;</span>, time<span style=color:#f92672>=</span>datetime<span style=color:#f92672>.</span>utcnow)
</span></span></code></pre></div></section><section><h3 id=how-to-exploit-this>how to exploit this?</h3><p>what if we tricked the template rendering into thinking our user-supplied content was code?</p><ul><li><p>if our username was <code>{{7*7}}</code>, it might be rendered as 49</p></li><li><p>Jinja2: <code>{{</code>&lt;CODE HERE><code>}}</code> e.g. <code>{{7*7}}</code> => <code>49</code></p></li></ul></section><section><h2 id=demohttpsgithubcomlachlan-waugh6443treemaindemosserver-side-injectionssti><a href=https://github.com/lachlan-waugh/6443/tree/main/demos/server-side-injection/ssti>Demo</a></h2></section></section><section><h2 id=ssrf>SSRF</h2><section data-shortcode-section><h3 id=server-side-request-forgery>Server-side request forgery</h3><ul><li>Trick a server into doing stuff it doesn&rsquo;t intend to</li><li>Consider <code>HAAS</code>, we can&rsquo;t access <code>KB</code>, but <code>HAAS</code> could, and we can send requests through <code>HAAS</code></li><li>What if we could access other internal services through <code>HAAS</code>, which aren&rsquo;t expecting it</li></ul></section><section><h3 id=exploitation>Exploitation</h3><ul><li>Internal services might (often will) be less secure than externally facing ones</li><li>What can we do?<ul><li>Retrieve/disclose information (ssi/lfi)</li><li>Remote code execution / Reverse shells?</li><li>Other bad stuff</li></ul></li></ul></section><section><h2 id=demohttpsgithubcomlachlan-waugh6443treemaindemosserver-side-injectionssrf><a href=https://github.com/lachlan-waugh/6443/tree/main/demos/server-side-injection/ssrf>Demo</a></h2></section></section><section><h3 id=next-week>next week</h3><p>?</p><ul><li>?</li></ul></section><section><h2 id=thanks>thanks!</h2><p>that&rsquo;s all :)</p></section></div></div><script type=text/javascript src=../reveal-hugo/object-assign.js></script>
<a href=../reveal-js/css/print/ id=print-location style=display:none></a>
<script type=text/javascript>var printLocationElement=document.getElementById("print-location"),link=document.createElement("link");link.rel="stylesheet",link.type="text/css",link.href=printLocationElement.href+(window.location.search.match(/print-pdf/gi)?"pdf.css":"paper.css"),document.getElementsByTagName("head")[0].appendChild(link)</script><script type=application/json id=reveal-hugo-site-params>null</script><script type=application/json id=reveal-hugo-page-params>null</script><script src=../reveal-js/js/reveal.js></script>
<script type=text/javascript>function camelize(e){return e&&Object.keys(e).forEach(function(t){newK=t.replace(/(_\w)/g,function(e){return e[1].toUpperCase()}),newK!=t&&(e[newK]=e[t],delete e[t])}),e}var revealHugoDefaults={center:!0,controls:!0,history:!0,progress:!0,transition:"slide"},revealHugoSiteParams=JSON.parse(document.getElementById("reveal-hugo-site-params").innerHTML),revealHugoPageParams=JSON.parse(document.getElementById("reveal-hugo-page-params").innerHTML),options=Object.assign({},camelize(revealHugoDefaults),camelize(revealHugoSiteParams),camelize(revealHugoPageParams));Reveal.initialize(options)</script><script type=text/javascript src=../reveal-js/plugin/markdown/marked.js></script>
<script type=text/javascript src=../reveal-js/plugin/markdown/markdown.js></script>
<script type=text/javascript src=../reveal-js/plugin/highlight/highlight.js></script>
<script type=text/javascript src=../reveal-js/plugin/zoom-js/zoom.js></script>
<script type=text/javascript src=../reveal-js/plugin/notes/notes.js></script></body></html>